---
title: "Determine the level of Obesity using known charasteristics"
author: "JASURBEK USMONALEIV"
date: "2024-04-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Installing and loading packages (if nessesery)

```{r}
listOfPackages <- c("ggplot2", "pheatmap", "tidyverse", "viridis", "RColorBrewer", "factoextra", "ggstatsplot", "psych", "Hmisc", "tidyr", "dplyr", "reshape2", "corrplot", "ggcorrplot", "stringr", "caret", "base", "randomForest", "dbscan", "stats","cluster")
for (i in listOfPackages){
     if(! i %in% installed.packages()){
         install.packages(i, dependencies = TRUE)
     }
     require(i, character.only = TRUE)
}
```

# 2. Loading the data
```{r}
# Load and inspect the data
data <- read.csv("Obesity_CW.csv")
str(data)
```







```{r}
# Summary report of the variables
summary(data)
```


```{r}
# Check for missingness
colSums(is.na(data))
```

```{r}
# Amend incorrectly loaded variables
data$Gender <- as.factor(data$Gender)
data$family_history_with_overweight <- as.factor(data$family_history_with_overweight)
data$FAVC <- as.factor(data$FAVC)
data$CAEC <- as.factor(data$CAEC)
data$SMOKE <- as.factor(data$SMOKE)
data$SCC <- as.factor(data$SCC)
data$CALC <- as.factor(data$CALC)
data$MTRANS <- as.factor(data$MTRANS)

# Check the change has happened
str(data)
```

```{r}
# Understand the data
describe(data)
```


```{r}
head(data)
```



# 3. Data cleaning
```{r}
# Make the column names more understandable
names(data) [names(data) == 'FAVC'] <- 'FCHighCal'
names(data) [names(data) == 'FCVC'] <- 'FCvegetables'
names(data) [names(data) == 'NCP'] <- 'NumMainMeals'
names(data) [names(data) == 'CAEC'] <- 'ConsFoodBetwMeal'
names(data) [names(data) == 'CH2O'] <- 'DayWater'
names(data) [names(data) == 'CALC'] <- 'Alcohol'
names(data) [names(data) == 'SCC'] <- 'MonitorCalory'
names(data) [names(data) == 'FAF'] <- 'PhysicalActFreq'
names(data) [names(data) == 'NObeyesdad'] <- 'ObesityLevel'
names(data) [names(data) == 'TUE'] <- 'TechUsePerDay'
```

```{r}
# Deleting id column as it's unneeded
data <- data %>% 
  select(-id)

# Convert the Age column to integer
data$Age <- as.integer(floor(data$Age))

# Converting Height into cm 
data$Height <- data$Height * 100
data$Height <- signif(data$Height, digits = 3)

# Converting Weight into integer
data$Weight <- data$Weight * 100
data$Weight <- signif(data$Weight, digits = 3)
data$Weight <- data$Weight %/% 100

# Remove leading and trailing white space & standardize levels in Gender
data$Gender <- trimws(tolower(data$Gender))
```

```{r}
# Convert brinary strings to integers
# In Gender, convert 'male' 'female' to 1 0 respectively
data <- data %>%
  mutate(Gender = ifelse(Gender == "male", 1, 0))

# In family_history_with_overweight, convert 'yes' 'no' to 1 0 respectively
data <- data %>%
  mutate(family_history_with_overweight = ifelse(family_history_with_overweight == "yes", 1, 0))

# In FCHCfood, convert 'yes' 'no' to 1 0 respectively
data <- data %>%
  mutate(FCHighCal = ifelse(FCHighCal== "yes", 1, 0))

# In SMOKE, convert 'yes' 'no' to 1 0 respectively
data <- data %>%
  mutate(SMOKE = ifelse(SMOKE== "yes", 1, 0))

# In MonitorCalory, convert 'yes' 'no' to 1 0 respectively
data <- data %>%
  mutate(MonitorCalory = ifelse(MonitorCalory== "yes", 1, 0))
```

```{r}
# Convert string factors to numerical levels
# Convert levels in ConsFoodBetwMeal to numerical values
data <- data %>%
  mutate(ConsFoodBetwMeal = recode_factor(ConsFoodBetwMeal,
                                          "Always" = 1,
                                          "Frequently" = 2,
                                          "no" = 3,
                                          "Sometimes" = 4))
data$ConsFoodBetwMeal <- as.numeric(data$ConsFoodBetwMeal)

# Convert levels in Alcohol to numerical values
data$Alcohol <- as.numeric(recode_factor(data$Alcohol,
                                         "Frequently" = 1,
                                         "no" = 2,
                                         "Sometimes" = 3))

# Convert levels in MTRANS to numerical values
data$MTRANS <- as.numeric(recode_factor(data$MTRANS,
                                        "Automobile" = 1,
                                        "Bike" = 2,
                                        "Motorbike" = 3,
                                        "Public_Transportation" = 4,
                                        "Walking" = 5))
```

```{r}
# Round FCvegetables, NumMainMeals, DayWater, PhysicalActFreq, TUE to 2 decimals
data$FCvegetables <- round(data$FCvegetables, digits = 1)
data$NumMainMeals <- round(data$NumMainMeals, digits = 1)
data$DayWater <- round(data$DayWater, digits = 1)
data$PhysicalActFreq <- round(data$PhysicalActFreq, digits = 1)
data$TechUsePerDay <- round(data$TechUsePerDay, digits = 1)
```

```{r}
# Converting ObesityLevel levels to numeric values
data$ObesityLevel <- as.character(data$ObesityLevel)  # Converting to character before changing to numeric

data$ObesityLevel[data$ObesityLevel == "Insufficient_Weight"] <- "0"
data$ObesityLevel[data$ObesityLevel == "Normal_Weight"] <- "1"
data$ObesityLevel[data$ObesityLevel == "Overweight_Level_I"] <- "2"
data$ObesityLevel[data$ObesityLevel == "Overweight_Level_II"] <- "3"
data$ObesityLevel[data$ObesityLevel == "Obesity_Type_I"] <- "4"
data$ObesityLevel[data$ObesityLevel == "Obesity_Type_II"] <- "5"
data$ObesityLevel[data$ObesityLevel == "Obesity_Type_III"] <- "6"

data$ObesityLevel<- as.factor(data$ObesityLevel) # Convert to factor
```

```{r}
# Amend incorrectly loaded variables
data$Gender <- as.factor(data$Gender)
data$family_history_with_overweight <- as.factor(data$family_history_with_overweight)
data$FCHighCal <- as.factor(data$FCHighCal)
data$ConsFoodBetwMeal <- as.factor(data$ConsFoodBetwMeal)
data$SMOKE <- as.factor(data$SMOKE)
data$MonitorCalory <- as.factor(data$MonitorCalory)
data$Alcohol <- as.factor(data$Alcohol)
data$MTRANS <- as.factor(data$MTRANS)
data$ObesityLevel <- as.factor(data$ObesityLevel)

# Print factor levels
levels_of_variables <- sapply(data, function(x) if(is.factor(x)) levels(x) else NA)
print(levels_of_variables)
```
```{r}
head(data)
```

# Exploratory Data Analysis

```{r}
# Analyze gender
gender_counts <- table(data$Gender)
gender_proportions <- prop.table(gender_counts)
gender_summary <- data.frame(Gender = names(gender_counts), Count = gender_counts, Proportion = gender_proportions)

# Visualize gender distribution
ggplot(gender_summary, aes(x = Gender, y = Proportion.Freq)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "blue") +
  labs(x = "Gender", y = "Proportion", title = "Distribution of Gender")

# Analyze family history of overweight
fam_history_counts <- table(data$family_history_with_overweight)
fam_history_proportions <- prop.table(fam_history_counts)
fam_history_summary <- data.frame(Family_History = names(fam_history_counts), Count = fam_history_counts, Proportion = fam_history_proportions)

# Visualize family history of overweight distribution
ggplot(fam_history_summary, aes(x = Family_History, y = Proportion.Freq)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "blue") +
  labs(x = "Family History of Overweight", y = "Proportion", title = "Distribution of Family History of Overweight")+
  scale_x_discrete(labels = c("Female", "Male"))
```
In the first graphic we see that this popultion is split evenly between Males and Females. We also see that there is a relationship between familial history of obesity - especially among males.

```{r}
# Calculate summary statistics for age within each level of physical activity frequency
age_summary <- aggregate(data$Age, by = list(data$PhysicalActFreq), FUN = summary)

# Visualize the distribution of age across different levels of physical activity frequency
ggplot(data, aes(x = factor(PhysicalActFreq), y = Age)) +
  geom_boxplot(fill = "skyblue", color = "blue") +
  labs(x = "Physical Activity Frequency", y = "Age", title = "Distribution of Age Across Physical Activity Frequency Levels") +
  theme_minimal()
```
This box plot supports our suspicion that people in their mid 20's are generally in a normal range of healthy weight, likely because most people exercise while in their mid-20's.

```{r}
# Histograms
# age 
ggplot(data, aes(x = Age)) +
  geom_histogram(binwidth = 1, color = "blue", fill = "skyblue", alpha = 1) +
  labs(title = "Distribution of Age",
       x = "Age",
       y = "Frequency") +
  scale_x_continuous(breaks = seq(5, 65, by = 5)) 

# height
ggplot(data, aes(x = Height)) +
  geom_histogram(binwidth = 1, color = "blue", fill = "skyblue", alpha = 1) +
  labs(title = "Distribution of Height",  
       x = "Height",                     
       y = "Frequency")

# weight
ggplot(data, aes(x = Weight)) +
  geom_histogram(binwidth = 1, color = "blue", fill = "skyblue", alpha = 1) +
  labs(title = "Distribution of Weight", 
       x = "Height",                     
       y = "Frequency") +
  scale_x_continuous(breaks = seq(50, 180, by = 10))  

# ConsFoodBetwMeal
# Convert 'ConsFoodBetwMeal' to a numeric variable
data$ConsFoodBetwMeal <- as.numeric(as.character(data$ConsFoodBetwMeal))

# Create histogram using ggplot
ggplot(data = data, aes(x = ConsFoodBetwMeal)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "blue") +
  labs(x = "Consistency of Food Consumption Between Meals", y = "Frequency", title = "Histogram of Consistency of Food Consumption Between Meals")

# FCvegetables
ggplot(data, aes(x = FCvegetables)) +
  geom_histogram(color = "blue", fill = "skyblue", alpha = 1, binwidth = 0.1, bins = 30) +
  labs(title = "Distribution of FCvegetables",
       x = "FCvegetables",
       y = "Frequency")

# NumMainMeals
ggplot(data, aes(x = NumMainMeals)) +
  geom_histogram( color = "blue", fill = "skyblue", alpha = 1, binwidth = 0.1, bins = 30) +
  labs(title = "Distribution of NumMainMeals",
       x = "NumMainMeals",
       y = "Frequency") 

# DayWater
ggplot(data, aes(x = DayWater)) +
  geom_histogram(color = "blue", fill = "skyblue", alpha = 1, binwidth = 0.1, bins = 30) +
  labs(title = "Distribution of CH2O",
       x = "DayWater",
       y = "Frequency")

# PhysicalActFreq
ggplot(data, aes(x = PhysicalActFreq)) +
  geom_histogram( color = "blue", fill = "skyblue", alpha = 1, binwidth = 0.1, bins = 30) +
  labs(title = "Distribution of PhysicalActFreq",
       x = "PhysicalActFreq",
       y = "Frequency")

# TechUsePerDay
ggplot(data, aes(x = TechUsePerDay)) +
  geom_histogram(color = "blue", fill = "skyblue", alpha = 1, binwidth = 0.1, bins = 30) +
  labs(title = "Distribution of TechUsePerDay",
       x = "TechUsePerDay",
       y = "Frequency")
```

```{r}
# Bar plots of factor/binary variables
# gender
ggplot(data = data, aes(x = factor(Gender))) +
  geom_bar(fill = "skyblue", color = "blue") +
  labs(x = "Gender", y = "Count", title = "Bar Plot of Gender")

ggplot(data = data, aes(x = factor(ObesityLevel))) +
  geom_bar(fill = "skyblue", color = "blue") +
  labs(x = "Obesity Level", y = "Frequency", title = "Histogram of Obesity Levels")

ggplot(data = data, aes(x = factor(family_history_with_overweight))) +
  geom_bar(fill = "skyblue", color = "blue") +
  labs(x = "Family History with Overweight", y = "Frequency", title = "Bar Plot of Family History with Overweight")

ggplot(data = data, aes(x = factor(FCHighCal))) +
  geom_bar(fill = "skyblue", color = "blue") +
  labs(x = "Family Consumes High-Calorie Food", y = "Frequency", title = "Bar Plot of Family High-Calorie Food Consumption")

ggplot(data = data, aes(x = factor(SMOKE))) +
  geom_bar(fill = "skyblue", color = "blue") +
  labs(x = "Smoking Status", y = "Count", title = "Bar Plot of Smoking Status")

ggplot(data = data, aes(x = factor(MonitorCalory))) +
  geom_bar(fill = "skyblue", color = "blue") +
  labs(x = "Monitor Calorie Intake", y = "Count", title = "Bar Plot of Monitor Calorie Intake")

ggplot(data = data, aes(x = factor(Alcohol))) +
  geom_bar(fill = "skyblue", color = "blue") +
  labs(x = "Alcohol Consumption", y = "Count", title = "Bar Plot of Alcohol Consumption")

ggplot(data = data, aes(x = factor(MTRANS))) +
  geom_bar(fill = "skyblue", color = "blue") +
  labs(x = "Transportation Mode", y = "Count", title = "Bar Plot of Transportation Mode")
```

```{r}
# Boxplots
# Age
ggplot(data, aes(Age)) +
  geom_boxplot(fill = "lightblue", color = "blue", outlier.colour = 'red') +
  labs(title = "Box plot of Age",
       y = "Age") +
  theme_minimal()


# Height
ggplot(data = data, aes(Height)) +
  geom_boxplot(fill = "skyblue", color = "blue", outlier.colour = 'red') +
  labs( y = "Height", title = "Box Plot of Height")


# Weight
ggplot(data, aes(y = Weight)) +
  geom_boxplot(fill = "lightblue", color = "blue", outlier.colour = 'red') +
  labs(title = "Boxplot of Weight",
 
       y = "Weight") +
  theme_minimal() 


# FCvegetables
ggplot(data, aes( y = FCvegetables)) +
  geom_boxplot(fill = "lightblue", color = "blue", outlier.colour = 'red') +
  labs(title = "Boxplot of Frequent Consumption of vegetables",
  y = "FCvegetables") +
  theme_minimal()


# DayWater
ggplot(data, aes(y = DayWater)) +
  geom_boxplot(fill = "lightblue", color = "blue", outlier.colour = 'red') +
  labs(title = "Boxplot of DayWater",
       y = "DayWater") +
  theme_minimal()


# PhysicalActFreq
ggplot(data, aes(y = PhysicalActFreq)) +
  geom_boxplot(fill = "lightblue", color = "blue", outlier.colour = 'red') +
  labs(title = "Boxplot of Frequency of Physical activity",

       y = "PhysicalActFreq") +
  theme_minimal()


# TechUsePerDay
ggplot(data, aes(y = TechUsePerDay)) +
  geom_boxplot(fill = "lightblue", color = "blue", outlier.colour = 'red') +
  labs(title = "Boxplot of TechUsePerDay",

       y = "TechUsePerDay") +
  theme_minimal() 

```
As seen in the summary statistics, most of the population of in their mid 20s, around 170 cm in height and 85kg in weight. We can see that females tend to consume more vegetables but males drink similar amounts of water per day. Males typically excercise more and both genders spend a similar amount of time using technology.
```{r}
# Plot side-by-sides of both continuous and factor
# Weight & Obesity Level
ggplot(data = data, aes(x = factor(Gender), y = Weight, fill = ObesityLevel)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Weight", fill = "Obesity Level") +
  scale_fill_brewer(palette = "Set3") + 
  theme_minimal()+
  scale_x_discrete(labels = c("Female", "Male"))

# Weight & MTRANS
ggplot(data = data, aes(x = factor(Gender), y = Weight, fill = MTRANS)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Weight", fill = "MTRANS") +
  scale_fill_brewer(palette = "Set3") + 
  theme_minimal()+
  scale_x_discrete(labels = c("Female", "Male"))

# Weight & FCHighCal
ggplot(data = data, aes(x = factor(Gender), y = Weight, fill = FCHighCal)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Weight", fill = "FCHighCal") +
  scale_fill_brewer(palette = "Set3") + 
  theme_minimal()+
  scale_x_discrete(labels = c("Female", "Male"))

# Weight & family_history_with_overweight
ggplot(data = data, aes(x = factor(Gender), y = Weight, fill = family_history_with_overweight)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Weight", fill = "family_history_with_overweight") +
  scale_fill_brewer(palette = "Set3") + 
  theme_minimal()+
  scale_x_discrete(labels = c("Female", "Male"))

# Weight & SMOKE
ggplot(data = data, aes(x = factor(Gender), y = Weight, fill = SMOKE)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Weight", fill = "SMOKE") +
  scale_fill_brewer(palette = "Set3") + 
  theme_minimal()+
  scale_x_discrete(labels = c("Female", "Male"))

# Weight & MonitorCalory
ggplot(data = data, aes(x = factor(Gender), y = Weight, fill = MonitorCalory)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Weight", fill = "MonitorCalory") +
  scale_fill_brewer(palette = "Set3") + 
  theme_minimal()+
  scale_x_discrete(labels = c("Female", "Male"))

# Weight & Alcohol
ggplot(data = data, aes(x = factor(Gender), y = Weight, fill = Alcohol)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Weight", fill = "Alcohol") +
  scale_fill_brewer(palette = "Set3") + 
  theme_minimal()+
  scale_x_discrete(labels = c("Female", "Male"))
```
In the first graph, there is a clear positive relationship between Weight & Obesity Level across both Genders. Interestingly, females reach obese levels 4 & 5 quicker than males. There's also a sharp increase to obese level 6 - conversly to males who have a consistent level across all levels of obesity.
In the second graph, people who frequent method 4 seem to be generally more overweight than the other modes of transport.
Lifestyle methods affect weight as indicated by Frequent Consumption of High Calories, calory monitoring, and alcohol consumption.
The graph for family_history_with_overweight confirms the previous plots' conclusion that family history of obesity contibutes to an individuals weight.
On the other hand, smoking had little effect on female weights, while males who smoke generally weigh more than those that don't.

```{r}
# Scatter plot of height vs. weight
ggplot(data, aes(x = Height, y = Weight)) +
  geom_point(color = "blue") +
  labs(x = "Height", y = "Weight", title = "Relationship Between Height and Weight") +
  theme_minimal()

# Correlation analysis
correlation <- cor(data$Height, data$Weight)
print(paste("Correlation coefficient between height and weight:", correlation))

# Regression analysis
model <- lm(Weight ~ Height, data = data)
summary(model)
```
The correlation coefficient between height and weight is approximately 0.414. This indicates a moderate positive linear relationship between height and weight.
The coefficient for height is estimated to be approximately 1.250. This means that for every one-unit increase in height (e.g., 1 inch), the predicted weight increases by approximately 1.250 units (e.g., 1.250 pounds). Both the intercept and height coefficients have p-values much smaller than 0.05, indicating that they are statistically significant predictors of weight.


```{r}
# Convert ObesityLevel from factor to numeric
data$ObesityLevel <- as.numeric(as.character(data$ObesityLevel))

# Calculate Pearson correlation coefficient between weight and obesity level
correlation_weight_obesity <- cor(data$Weight, data$ObesityLevel)

# Print the correlation coefficient
print(paste("Pearson correlation coefficient between weight and obesity level:", correlation_weight_obesity))

```

The correlation coefficient ranges from -1 to 1. A correlation coefficient close to 1 indicates a strong positive linear relationship between the two variables. In this case, a coefficient of 0.922 suggests a very strong positive linear relationship between weight and obesity level. This implies that as weight increases, obesity level tends to increase as well, and vice versa.

It's important to note: Correlation does not imply causation. Even though weight and obesity level are highly correlated, it doesn't necessarily mean that changes in one variable cause changes in the other.
Other factors could influence both weight and obesity level, or the relationship could be more complex than a simple linear association.

```{r}
# Subset the data into two groups: with and without family history of overweight
with_history <- subset(data, family_history_with_overweight == 1)
without_history <- subset(data, family_history_with_overweight == 0)

# Create histograms or density plots for physical activity frequency for each group
ggplot() +
  geom_density(data = with_history, aes(x = PhysicalActFreq), fill = "blue", alpha = 0.5) +
  geom_density(data = without_history, aes(x = PhysicalActFreq), fill = "red", alpha = 0.5) +
  labs(x = "Physical Activity Frequency", y = "Density", title = "Distribution of Physical Activity Frequency by Family History of Overweight") +
  scale_fill_manual(values = c("blue", "red"), labels = c("With History", "Without History"))

# Calculate summary statistics for physical activity frequency for each group
summary_physical_activity <- data.frame(
  Group = c("With History", "Without History"),
  Mean = c(mean(with_history$PhysicalActFreq), mean(without_history$PhysicalActFreq)),
  SD = c(sd(with_history$PhysicalActFreq), sd(without_history$PhysicalActFreq))
)

print(summary_physical_activity)
```
This density plot shows that objects without a familial history of obesity excercise more than those that do.

```{r}
# Scatterplots
# Scatterplots of ObesityLevel(target var) with all variables
ggplot(data, aes(x=ObesityLevel, y=Gender, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and Gender")

ggplot(data, aes(x=ObesityLevel, y=Age, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and Age")

ggplot(data, aes(x=ObesityLevel, y=Height, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and Height")

ggplot(data, aes(x=ObesityLevel, y=Weight, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and Weight")

ggplot(data, aes(x=ObesityLevel, y=family_history_with_overweight, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and family_history_with_overweight")

ggplot(data, aes(x=ObesityLevel, y=FCHighCal, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and FCHC")

ggplot(data, aes(x=ObesityLevel, y=FCvegetables, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and FCvegetables")

ggplot(data, aes(x=ObesityLevel, y=NumMainMeals, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and NumMainMeals")

ggplot(data, aes(x=ObesityLevel, y=ConsFoodBetwMeal, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and ConsFoodBetwMeal")

ggplot(data, aes(x=ObesityLevel, y=SMOKE, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and SMOKE")

ggplot(data, aes(x=ObesityLevel, y=MonitorCalory, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and MonitorCalory")

ggplot(data, aes(x=ObesityLevel, y=DayWater, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and WayWater")

ggplot(data, aes(x=ObesityLevel, y=PhysicalActFreq, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and PyysicalActFreq")

ggplot(data, aes(x=ObesityLevel, y=TechUsePerDay, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and TechUsePerDay")

ggplot(data, aes(x=ObesityLevel, y=MTRANS, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and MTRANS")

ggplot(data, aes(x=ObesityLevel, y=Alcohol, group=1)) +geom_point() +geom_smooth(method = 'lm') +theme_bw() +ggtitle("Scatterplot ObesityLevel and Alcohol")
```

```{r}
# Density plots
# Age
ggplot(data, aes(x = Age)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +  # Use geom_density here
  labs(title = "Density Plot of Age",
       x = "Age",  # Set an appropriate x-axis label
       y = "Density") +  # Change y-axis label to 'Density'
  theme_minimal()

# FCvegetables
ggplot(data, aes(x = FCvegetables)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +  # Use geom_density here
  labs(title = "Density Plot of FCvegetables",
       x = "FCvegetables",  # Set an appropriate x-axis label
       y = "Density") +  # Change y-axis label to 'Density'
  theme_minimal()

# NumMainMeals
ggplot(data, aes(x = NumMainMeals)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +  # Use geom_density here
  labs(title = "Density Plot of NumMainMeals",
       x = "NumMainMeals",  # Set an appropriate x-axis label
       y = "Density") +  # Change y-axis label to 'Density'
  theme_minimal()

# DayWater
ggplot(data, aes(x = DayWater)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +  # Use geom_density here
  labs(title = "Density Plot of DayWater",
       x = "DayWater",  # Set an appropriate x-axis label
       y = "Density") +  # Change y-axis label to 'Density'
  theme_minimal()

# PhysicalActFreq
ggplot(data, aes(x = PhysicalActFreq)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +  # Use geom_density here
  labs(title = "Density Plot of PhysicalActFreq",
       x = "PhysicalActFreq",  # Set an appropriate x-axis label
       y = "Density") +  # Change y-axis label to 'Density'
  theme_minimal()

# TechUsePerDay
ggplot(data, aes(x = TechUsePerDay)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +  # Use geom_density here
  labs(title = "Density Plot of TechUsePerDay",
       x = "TechUsePerDay",  # Set an appropriate x-axis label
       y = "Density") +  # Change y-axis label to 'Density'
  theme_minimal()

# Height
ggplot(data, aes(x = Height)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +  # Use geom_density here
  labs(title = "Density Plot of Height",
       x = "Height",  # Set an appropriate x-axis label
       y = "Density") +  # Change y-axis label to 'Density'
  theme_minimal()

# Weight
ggplot(data, aes(x = Weight)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +  # Use geom_density here
  labs(title = "Density Plot of Weight",
       x = "Weight",  # Set an appropriate x-axis label
       y = "Density") +  # Change y-axis label to 'Density'
  theme_minimal()
```

```{r}
# Heatmap
num_data <- data[, sapply(data, is.numeric)]

# Calculate the correlation matrix on just the numeric data
cor_matrix <- cor(num_data, use = "complete.obs")

# Melt the correlation matrix into long format
melted_matrix <- melt(cor_matrix)

# Create the heatmap using ggplot2
heatmap_plot <- ggplot(melted_matrix, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "green", high = "red", mid = "yellow", midpoint = 0) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        axis.text.y = element_text(angle = 0, hjust = 1)) +
  labs(x = '', y = '', fill = 'Correlation')

# Print the heatmap plot
print(heatmap_plot)
```

```{r}
# Principal Component Analysis (PCA)
# Split the data into training and test sets
set.seed(123)
splitIndex <- createDataPartition(data$ObesityLevel, p = 0.7, list = FALSE)
train <- data[splitIndex, ]
test <- data[-splitIndex, ]

# Select only numeric columns (excluding the target variable)
numeric_columns <- sapply(train[, names(train) != "ObesityLevel"], is.numeric)
train_numeric <- train[, numeric_columns]

# Scale the numeric training data
train_scaled <- scale(train_numeric)

# Apply PCA
pca_result <- prcomp(train_scaled, center = TRUE, scale. = TRUE)
attributes(pca_result)

# Calculate the proportion of explained variance (PEV) from the std values
pca_var <- pca_result$sdev^2
pca_PEV <- pca_var/sum(pca_var)
plot(pca_result)

# plot the cumulative PEV
opar <- par(no.readonly = TRUE)
plot(
  cumsum(pca_PEV),
  ylim = c(0,1),
  xlab = 'PC',
  ylab = 'cumulative PEV',
  pch = 20,
  col = 'orange'
)
abline(h = 0.8, col = 'red', lty = 'dashed')
par(opar)

# Get and inspect the loadings
pca_loadings <- pca_result$rotation
pca_loadings
```
PC1 is influenced by weight and physical activity with strong positive loadings for Weight and TechUsePerDay - individuals with higher weights and more time spent on tech devices tend to have higher values of PC1. Conversely, it has negative loadings for variables like Age, Height, and DayWater, suggesting that younger individuals who are taller and drink more water tend to have lower values of PC1.

PC2: This component appears to be associated with dietary habits and food consumption. It has a strong negative loading for NumMainMeals, indicating that individuals with fewer main meals tend to have higher values of PC2. It also has positive loadings for variables like FCvegetables and ConsFoodBetwMeal, suggesting that individuals who consume more vegetables and have consistent food intake between meals tend to have higher values of PC2.

PC3: PC3 seems to be related to physical activity frequency and age. It has a positive loading for PhysicalActFreq, indicating that individuals who engage in physical activities more frequently tend to have higher values of PC3. Additionally, it has negative loadings for Age and TechUsePerDay, suggesting that younger individuals who spend less time on tech devices tend to have higher values of PC3.

PC4: This component appears to capture variations in food consumption patterns. It has positive loadings for variables like NumMainMeals and ConsFoodBetwMeal, indicating that individuals who have more main meals and consistent food consumption between meals tend to have higher values of PC4.

PC5: PC5 seems to be primarily influenced by variables related to age and height. It has positive loadings for Age and Height, suggesting that older individuals who are taller tend to have higher values of PC5.

PC6: PC6 appears to be associated with technology use and physical activity. It has positive loadings for TechUsePerDay and PhysicalActFreq, indicating that individuals who spend more time on tech devices and engage in physical activities more frequently tend to have higher values of PC6.

```{r}
# Plot the loadings for the first six PCs as a barplot
opar <- par(no.readonly = TRUE)
colvector = c('red', 'orange', 'yellow', 'green', 'cyan', 'blue', 'steelblue','pink','grey')
labvector = c('PC1', 'PC2', 'PC3', 'PC4', 'PC5', 'PC6')
barplot(
  pca_loadings[,c(1:6)],
  beside = T,
  yaxt = 'n',
  names.arg = labvector,
  col = colvector,
  ylim = c(-1,1),
  border = 'white',
  ylab = 'loadings'
)
axis(2, seq(-1,1,0.1))
legend(
  'bottomright',
  bty = 'n',
  col = colvector,
  pch = 15,
  row.names(pca_loadings)
)
par(opar)
```

```{r}
# DBSCAN clustering
# Select the first 6 principal components
pcs <- pca_result$x[, 1:6]

# Perform DBSCAN clustering with different parameter values
dbscan_result <- dbscan(pcs, eps = 0.5, minPts = 5)

# Print the clusters
print(dbscan_result$cluster)

# Visualize clusters if possible
# For example, if you have 2D or 3D data, you can plot the clusters
if (ncol(pcs) == 2) {
  plot(pcs, col = dbscan_result$cluster + 1, pch = 20, main = "DBSCAN Clustering")
} else if (ncol(pcs) == 3) {
  scatter3D(pcs[,1], pcs[,2], pcs[,3], colvar = dbscan_result$cluster + 1, pch = 20, main = "DBSCAN Clustering")
}

# Evaluate clustering if ground truth labels are available
# For example, using silhouette score
silhouette_score <- silhouette(dbscan_result$cluster, dist(pcs))
silhouette_score
```


```{r}
# Hierarchichal clustering
# First generate the distance matrix with euclidian distance
dist_data <- dist(data[,-17], method = 'euclidian')
# Apply complete linkage
hc_data <- hclust(dist_data, method = 'complete')
hc_data

# plot the associated dendrogram
plot(hc_data, hang = -0.1, labels = data$ObesityLevel)

# 'cut' the dendrogram to select one partition with 6 groups
hc_cluster_data <- cutree(hc_data, k = 6)
```

```{r}
# K-means
k_data = kmeans(data[,-17], 6)
k_data

# Get the cluster id from the kmeans object
k_data_cluster <- k_data$cluster

# Calculate the silhoutte score for the two cluster solutions
sil_hc_data <- cluster::silhouette(hc_cluster_data, dist_data)
sil_k_data <- cluster::silhouette(k_data_cluster, dist_data)

# Plot the results of the silhoutte analysis for the two cluster solutions
opar <- par(no.readonly = TRUE)
par(mfrow = c(2,1))
plot(sil_hc_data, border = 'steelblue')
plot(sil_k_data, border = 'orange')
par(opar)

# Plot the k-means clus
plot(sil_k_data, border = 'orange')
```
An average silhouette width above 0.5 is considered to indicate a strong structure and well-separated clusters. An average silhouette width between 0.25 and 0.5 is considered reasonable. The K-Means average (0.35) silhouette width is larger than the Hierarchical cluster (0.32), therefore the K-means cluster best fits the clusters in this data.


#MODELLING
SupportVectorMachines - JASURBEK USMONALIEV 2255209
```{r}
library(e1071)
library(caret)

# Set seed
set.seed(123)

# Splitting data
splitIndex <- createDataPartition(data$ObesityLevel, p = 0.8, list = FALSE)
train <- data[splitIndex, ]
test <- data[-splitIndex, ]

target_levels <- unique(data$ObesityLevel)

# Convert factor variables
train$ObesityLevel <- factor(train$ObesityLevel, levels = target_levels)
test$ObesityLevel <- factor(test$ObesityLevel, levels = target_levels)

# Train
model <- svm(ObesityLevel ~ ., data = train, method = "svm", kernel = "radial")

# Predictiont
predictions <- predict(model, test)


# Evaluatation
confusionMatrix(predictions, as.factor(test$ObesityLevel))
```

```{r}
cm <- confusionMatrix(predictions, as.factor(test$ObesityLevel))
cm_table <- as.table(cm$table)
melted_cm <- melt(cm_table)
names(melted_cm) <- c("Reference", "Prediction", "Count")

#heatmap
ggplot(data = melted_cm, aes(x = Reference, y = Prediction, fill = Count)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "blue") +
  theme_minimal() +
  labs(x = "Reference", y = "Prediction", fill = "Count") +
  ggtitle("Confusion Matrix Heatmap") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


